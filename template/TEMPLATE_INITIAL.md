# {プロジェクト名} 設計書

作成日: {YYYY-MM-DD}  
作成モデル: {ex: claude-4-sonnet, claude-4-opus, o3}  

## 1. 目的と概要
{プロジェクト全体の目的を簡潔に記述。アーキテクチャ原則の抜粋を引用して、設計の指針を示す。  

- 注意点/理由: このセクションはプロジェクトの全体像を共有するためのもの。抜粋を引用することで、アーキテクチャ遵守を意識させ、チームメンバーが一貫した理解を持つようにする。
例: 本プロジェクトは、ユーザー管理と支払い処理を統合したWebアプリを目的とする。アーキテクチャ原則に基づき、依存方向を厳守（coreは純粋関数のみ、副作用はhandler.tsで処理）。本テンプレートは、実装計画書の基盤を提供し、詳細設計は各実装計画書に委ねる。}


## 2. ドメインリスト
{ドメインを洗い出し、依存関係を表で記述。Flowの必要性を特定するための基盤とする。各ドメインの概要は、要件から抽出した簡単な役割を具体的に書く。  
- 注意点/理由: 表形式で視覚的にわかりやすくするため。概要を具体的に例示することで、ドメインの境界を明確にし、早期に依存のミスを発見できる。Flowのヒントを入れるのは、複数ドメインのオーケストレーションを設計段階で予見するため（アーキテクチャ原則のflows/参照）。
例: Userドメインはユーザー登録・認証を扱い、Paymentドメインは決済処理を担当。}

| ドメイン名 | 概要 | 依存ドメイン |
|------------|------|--------------|
| User      | ユーザー管理（登録、認証、プロフィール更新など） | なし        |
| Payment   | 支払い処理（決済実行、履歴管理など） | User        |
| ...       | ...  | ...         |


## 3. 全体アーキテクチャ図
{ディレクトリ構成のツリー図を作成。全ドメイン/Flowの枠組みを示す。詳細ファイル（例: 具体的なcommand名）は実装計画書で追加。  
例: features/user/の下にcore/policy/port/command/queryのサブディレクトリを想定。- **レイヤ責務の再確認**: {アーキテクチャ原則の表を簡略コピー。例: core/は副作用ゼロの純粋関数、adapter/は外部依存カプセル化。}
- **注意点/理由**: ツリー図は構造を一目で把握させるための視覚ツール。例を入れることで、抽象的なディレクトリが具体的にイメージしやすくなり、レビュー時の議論を促進。レイヤ責務を再確認するのは、依存方向の違反を防ぐため。
}

```
src/
├── features/
│   ├── user/  # core/policy/port/command/queryの枠組み（例: core/user.tsで純粋関数定義）
│   └── payment/  # 同上（例: port/paymentService.tsで外部API抽象化）
├── flows/
│   └── user-payment/  # handler.tsのみ（例: 複数ドメインの順序制御）
├── adapter/  # repository/serviceの枠組み（例: repository/userRepository.prisma.ts）
├── interfaces/
└── shared/
```


## 4. UseCaseカタログ
{全command/query/Flowの概要カタログを作成。詳細要件（入力/出力型、エッジケース）は実装計画書の3.2で扱う。各UseCaseの概要は、期待される動作を簡潔に例示。

- シーケンス概要: {高レベルなフロー記述。例: interfaces/api → flows/handler → command/handler → adapter/repository。詳細シーケンスは実装計画書の3.2で定義。}
- 注意点/理由: 表をシンプルに保つことで、UseCaseの全体像を素早く把握。概要に具体的な動作例を入れるのは、テンプレート使用者が「何を書くか」のモデルを提供するため。シーケンスを高レベルに留めるのは、設計段階での柔軟性を確保し、詳細を後回しにするため。
}

| UseCase名 | タイプ | 概要 |
|-----------|--------|------|
| create-user | command | ユーザー作成（入力検証後、DB保存） |
| get-user | query | ユーザー取得（ID指定でデータ返却） |
| user-payment | flow | ユーザー支払い処理（ユーザー認証後、決済実行） |
| ... | ... | ... |


## 5. Portカタログ
{Portの抽象概要を作成。Repository（DBアクセス）とService（外部API/LLM呼び出し）の両方をカバー。目的は役割を抽象的に例示。詳細メソッドや実装は実装計画書の4.3で扱う。
- ガイドライン: {interface推奨。RepositoryはDB永続化中心、Serviceは外部サービスカプセル化を意識。ドメイン語彙の扱いなど、アーキテクチャガイドラインを参照。}
- 注意点/理由: タイプを明示することで、Repository/Serviceの区別を明確にし、adapter/の実装方針を予見。目的に例を入れるのは、抽象的なPortが具体的に理解しやすくなり、設計の漏れを防ぐため。ガイドライン参照を促すのは、アーキテクチャ原則の遵守を強化するため。
}

| Port名 | タイプ (Repository/Service) | 目的 |
|--------|-----------------------------|------|
| UserRepository | Repository | ユーザーDB操作（例: 作成・取得・更新の抽象インターフェイス） |
| PaymentService | Service | 外部支払いAPI呼び出し（例: 決済処理・検証の抽象化） |
| ... | ... | ... |


## 6. テスト戦略概要
{レイヤごとの高レベル計画を作成。詳細ケースは実装計画書の3.5で扱う。各特徴概要に簡単な例を追加。
- 注意点/理由: 概要に例を入れることで、テストのイメージを具体化。全体を高レベルに留めるのは、設計段階でテストの枠組みだけを決めておき、詳細を実装時に柔軟に調整するため。
}

| レイヤ | テスト種類 | 特徴概要 |
|--------|------------|----------|
| core/ | ユニット | モック不要（例: 純粋関数の入力/出力検証） |
| command/query/ | ユニット | Portダミー注入（例: 副作用の模擬実行） |
| ... | ... | ... |


## 7. レビューとイテレーション計画
{ステップ3.5に基づき記述。実装計画書作成前のチェックポイントを具体的に例示。  
例: レビュー項目: 依存方向違反の確認（例: core/にadapter依存がないか）、ドメイン漏れのチェック。イテレーション: 1-2回想定、不備時はセクション2に戻る。}

## 8. FAQ/追加考慮
{設計時のQ&Aを記述。例: Q. 詳細はどこで定義？ A. 実装計画書の詳細要件セクション（3.2）。Q. Flowを作成する基準は？ A. 2つ以上のcommand/query結合時（アーキテクチャ原則参照）。}
